<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YOU HAVE BEEN CHOSEN</title>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --blood-red: #ff4757;
            --holy-gold: #ffd700;
        }
        body { margin: 0; background: #000; color: white; font-family: 'Courier New', Courier, monospace; overflow: hidden; touch-action: none; transition: background 1.5s; }
        canvas { display: block; width: 100vw; height: 100vh; }

        /* Game UI */
        #game-title {
            position: absolute; top: 5%; width: 100%; text-align: center;
            font-size: 1.2rem; letter-spacing: 3px; color: var(--neon-blue);
            text-shadow: 0 0 8px var(--neon-blue); pointer-events: none;
            text-transform: uppercase; animation: flicker 3s infinite;
        }
        body.light-mode #game-title { color: white; text-shadow: 0 0 10px var(--holy-gold); }

        #ui { position: absolute; top: 12%; width: 100%; text-align: center; pointer-events: none; }
        #score { font-size: 50px; font-weight: bold; }

        /* Game Over / Invite Screen */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); display: none;
            flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box; z-index: 20; text-align: center;
        }
        body.light-mode #overlay { background: rgba(255, 255, 255, 0.95); color: #222; }

        .invite-text { color: var(--blood-red); font-size: 1.1rem; margin-bottom: 10px; line-height: 1.4; }
        body.light-mode .invite-text { color: #444; }

        .glitch { font-weight: bold; text-transform: uppercase; font-size: 1.3rem; display: block; color: white; margin: 5px 0; }
        body.light-mode .glitch { color: #000; }

        /* Buttons */
        .btn-group { display: flex; flex-direction: column; gap: 10px; width: 80%; max-width: 300px; margin-top: 15px; }
        button { 
            background: transparent; border: 1px solid var(--neon-blue); color: var(--neon-blue);
            padding: 15px; cursor: pointer; font-family: inherit; font-weight: bold; text-transform: uppercase;
        }
        body.light-mode button { border-color: #555; color: #555; }
        
        #jumpscare-toggle { display: none; border-color: #555; color: #777; font-size: 0.7rem; margin-top: 10px; }

        /* Jumpscare */
        #jumpscare { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: black; z-index: 100; display: none; }
        #jumpscare img { width: 100%; height: 100%; object-fit: cover; }

        #salvation-choice, #salvation-result { display: none; flex-direction: column; align-items: center; }

        @keyframes flicker { 0%, 18%, 22%, 25%, 53%, 57%, 100% { opacity: 1; } 20%, 24%, 55% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div id="game-title">YOU HAVE BEEN CHOSEN</div>
    <div id="ui"><div id="score">0</div></div>

    <div id="overlay">
        <div id="main-ui">
            <div id="lose-verse" style="margin-bottom: 15px; font-style: italic; font-size: 0.9rem;"></div>
            <div class="invite-text">
                YOUR SOUL HAS FALLEN...<br>
                <span class="glitch">VISIT OUR ESCAPE ROOM AT JRN 104</span><br>
                FEB 11-14 | 8 AM
            </div>
            <div class="btn-group">
                <button onclick="resetGame()">TRY TO ESCAPE AGAIN</button>
                <button id="jumpscare-toggle" onclick="showSalvation()">TURN OFF JUMPSCARE</button>
            </div>
        </div>

        <div id="salvation-choice">
            <p style="font-size: 1.5rem;">WANT TO BE SAVED?</p>
            <div class="btn-group">
                <button onclick="salvationAnswer(true)">YES</button>
                <button onclick="salvationAnswer(false)">NO</button>
            </div>
        </div>

        <div id="salvation-result">
            <p id="result-msg" style="font-weight: bold;"></p>
            <p id="bible-quote" style="font-size: 0.9rem; padding: 20px; color: var(--holy-gold);"></p>
            <button onclick="closeSalvation()">CONTINUE IN LIGHT</button>
        </div>
    </div>

    <div id="jumpscare">
        <img id="scare-img" src="https://via.placeholder.com/800x1200/000000/ff0000?text=RUN">
        <audio id="scream-snd" src="https://www.soundjay.com/human/sounds/scream-01.mp3"></audio>
    </div>

    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');
    
    let isLightMode = false;
    let jumpscareEnabled = true;
    let hasExperiencedScare = false; // The trigger
    let score = 0, gameActive = true;
    let width, height, dpr;
    
    const gravity = 0.15, jumpPower = -6, pipeSpeed = 2.2;
    let bird = { x: 50, y: 0, velocity: 0, radius: 10 };
    let pipes = [], frameCount = 0;

    const BIBLE_VERSES = [
        "John 3:16 - For God so loved the world, that He gave His only begotten Son.",
        "Philippians 4:13 - I can do all things through Christ who strengthens me.",
        "Psalm 23:4 - Even though I walk through the valley of shadow, I will fear no evil.",
        "Romans 8:31 - If God is for us, who can be against us?",
        "John 8:12 - I am the light of the world. Whoever follows me will never walk in darkness.",
        "2 Timothy 1:7 - For God has not given us a spirit of fear, but of power and of love."
    ];

    function resize() {
        dpr = window.devicePixelRatio || 1;
        width = window.innerWidth; height = window.innerHeight;
        canvas.width = width * dpr; canvas.height = height * dpr;
        ctx.scale(dpr, dpr);
        bird.y = height / 2; bird.x = width * 0.2;
    }

    function showSalvation() {
        document.getElementById('main-ui').style.display = 'none';
        document.getElementById('salvation-choice').style.display = 'flex';
    }

    function salvationAnswer(yes) {
        document.getElementById('salvation-choice').style.display = 'none';
        const result = document.getElementById('salvation-result');
        const msg = document.getElementById('result-msg');
        const quote = document.getElementById('bible-quote');

        msg.innerText = yes ? "You are already saved through the blood of Jesus Christ!" 
                            : "Too bad, Jesus Christ has saved you and He loves you very much.";

        quote.innerText = BIBLE_VERSES[Math.floor(Math.random() * BIBLE_VERSES.length)];
        result.style.display = 'flex';
        
        isLightMode = true;
        jumpscareEnabled = false;
        document.body.classList.add('light-mode');
    }

    function closeSalvation() {
        document.getElementById('salvation-result').style.display = 'none';
        document.getElementById('main-ui').style.display = 'flex';
        resetGame();
    }

    function gameOver() {
        if (!gameActive) return;
        gameActive = false;

        if (jumpscareEnabled && Math.random() < 0.3) {
            hasExperiencedScare = true; // Player has been scared
            triggerScare();
        } else {
            showOverlay();
        }
    }

    function showOverlay() {
        // Show verse if in Light Mode
        document.getElementById('lose-verse').innerText = isLightMode ? BIBLE_VERSES[Math.floor(Math.random() * BIBLE_VERSES.length)] : "";
        
        // Only show the "Turn off" button if they've been scared before
        if (hasExperiencedScare && !isLightMode) {
            document.getElementById('jumpscare-toggle').style.display = 'block';
        }

        document.getElementById('score').innerText = Math.floor(score);
        overlay.style.display = 'flex';
    }

    function triggerScare() {
        const js = document.getElementById('jumpscare');
        js.style.display = 'block';
        document.getElementById('scream-snd').play().catch(() => {});
        setTimeout(() => { js.style.display = 'none'; showOverlay(); }, 1200);
    }

    function resetGame() {
        score = 0; pipes = []; bird.y = height / 2; bird.velocity = 0;
        gameActive = true; overlay.style.display = 'none';
    }

    function update() {
        if (!gameActive) return;
        bird.velocity += gravity;
        bird.y += bird.velocity;
        if (bird.y + bird.radius > height || bird.y - bird.radius < 0) gameOver();
        if (frameCount % 110 === 0) spawnPipe();
        pipes.forEach(p => {
            p.x -= pipeSpeed;
            if (bird.x + bird.radius > p.x && bird.x - bird.radius < p.x + 70) {
                if (bird.y - bird.radius < p.topHeight || bird.y + bird.radius > p.topHeight + 190) gameOver();
            }
            if (!p.passed && p.x + 70 < bird.x) { p.passed = true; score++; }
        });
        pipes = pipes.filter(p => p.x + 70 > 0);
        frameCount++;
    }

    function draw() {
        ctx.fillStyle = isLightMode ? '#87CEEB' : '#050505';
        ctx.fillRect(0, 0, width, height);

        pipes.forEach(p => {
            ctx.fillStyle = isLightMode ? '#fff' : '#111';
            ctx.strokeStyle = isLightMode ? '#ffd700' : '#ff4757';
            ctx.lineWidth = 4;
            ctx.fillRect(p.x, 0, 70, p.topHeight);
            ctx.strokeRect(p.x, -5, 70, p.topHeight + 5);
            ctx.fillRect(p.x, p.topHeight + 190, 70, height - p.topHeight - 190);
            ctx.strokeRect(p.x, p.topHeight + 190, 70, height - p.topHeight - 190 + 5);
        });

        // Player
        ctx.fillStyle = isLightMode ? '#ffd700' : '#00f2ff';
        ctx.shadowBlur = 20;
        ctx.shadowColor = isLightMode ? '#fff' : '#00f2ff';
        if (isLightMode) {
            ctx.fillRect(bird.x - 4, bird.y - 12, 8, 24); // Cross Vertical
            ctx.fillRect(bird.x - 12, bird.y - 4, 24, 8); // Cross Horizontal
        } else {
            ctx.beginPath();
            ctx.arc(bird.x, bird.y, 10, 0, Math.PI * 2);
            ctx.fill();
        }
        ctx.shadowBlur = 0;
    }

    function spawnPipe() {
        const top = Math.random() * (height - 300) + 50;
        pipes.push({ x: width, topHeight: top, passed: false });
    }

    function loop() { update(); draw(); requestAnimationFrame(loop); }
    window.addEventListener('touchstart', (e) => { e.preventDefault(); if(gameActive) bird.velocity = jumpPower; }, {passive: false});
    window.addEventListener('mousedown', () => { if(gameActive) bird.velocity = jumpPower; });
    window.addEventListener('resize', resize);
    resize(); loop();
</script>
</body>
</html>
