<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YOU HAVE BEEN CHOSEN</title>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --blood-red: #ff4757;
            --holy-gold: #ffd700;
        }

        * { touch-action: none; -webkit-tap-highlight-color: transparent; user-select: none; }

        body { 
            margin: 0; background: #050505; color: white; 
            font-family: 'Courier New', Courier, monospace; 
            overflow: hidden; transition: background 1.5s; 
        }
        
        canvas { display: block; width: 100vw; height: 100vh; }

        /* Loading Screen */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 2000; display: flex; 
            flex-direction: column; justify-content: center; align-items: center;
        }

        /* Scoring and Title */
        #game-title {
            position: absolute; top: 4%; width: 100%; text-align: center;
            font-size: clamp(0.8rem, 3vw, 1.2rem); letter-spacing: 4px; color: var(--neon-blue);
            text-shadow: 0 0 8px var(--neon-blue); pointer-events: none;
            text-transform: uppercase; opacity: 0.8;
        }
        #score-display {
            position: absolute; top: 8%; width: 100%; text-align: center;
            font-size: clamp(2.5rem, 10vw, 4.5rem); font-weight: bold; pointer-events: none;
            z-index: 10; font-family: sans-serif;
        }

        /* Overlays */
        #overlay, #salvation-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.98); display: none;
            flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box; z-index: 50; text-align: center;
            touch-action: auto !important; pointer-events: auto !important;
        }
        body.light-mode #overlay { background: rgba(255, 255, 255, 0.98); color: #222; }

        .location-box {
            border: 2px solid var(--blood-red); padding: 15px; margin: 15px 0;
            background: rgba(255, 71, 87, 0.1); width: 90%; max-width: 400px;
        }
        .location-text { font-size: clamp(1.2rem, 5vw, 2rem); font-weight: bold; display: block; letter-spacing: 2px; }
        .date-text { font-size: 1rem; color: var(--blood-red); }

        .btn-group { display: flex; flex-direction: column; gap: 15px; width: 85%; max-width: 320px; }
        button { 
            background: transparent; border: 2px solid var(--neon-blue); color: var(--neon-blue);
            padding: 18px; cursor: pointer; font-family: inherit; font-weight: bold;
            text-transform: uppercase; font-size: 1.1rem; touch-action: manipulation;
        }
        button:active { background: var(--neon-blue); color: #000; }

        /* Jumpscare */
        #jumpscare {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: black; z-index: 1000; display: none;
            justify-content: center; align-items: center; overflow: hidden;
        }
        #jumpscare img { width: 125%; height: 125%; object-fit: cover; }
        .shake-active { animation: shake 0.08s infinite; }
        @keyframes shake {
            0% { transform: translate(2px, 2px); }
            50% { transform: translate(-2px, -2px); }
            100% { transform: translate(2px, 2px); }
        }
    </style>
</head>
<body>

    <div id="loading-screen"><div style="color:red; letter-spacing:5px;">PREPARING...</div></div>
    <div id="game-title">YOU HAVE BEEN CHOSEN</div>
    <div id="score-display">0</div>

    <div id="overlay">
        <div id="content-area"></div>
        <div class="btn-group">
            <button onclick="resetGame()">TRY AGAIN</button>
            <button onclick="shareGame()">SHARE FATE</button>
            <button id="jumpscare-toggle" onclick="showSalvation()" style="font-size:0.6rem; opacity:0.5;">REJECT THE DARKNESS</button>
        </div>
    </div>

    <div id="salvation-overlay">
        <p>DO YOU SEEK THE LIGHT?</p>
        <div style="display:flex; gap:10px;">
            <button onclick="salvationAnswer(true)">YES</button>
            <button onclick="salvationAnswer(false)">NO</button>
        </div>
    </div>

    <div id="jumpscare">
        <img id="scare-img" src=""><audio id="scream-snd" src=""></audio>
    </div>

    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score-display');
    const overlay = document.getElementById('overlay');
    
    let isLightMode = false, jumpscareEnabled = true, hasExperiencedScare = false;
    let score = 0, gameActive = false, width, height, dpr, frameCount = 0;
    let highScore = localStorage.getItem('jrn104_highScore') || 0;
    
    const gravity = 0.18, jumpPower = -5.5, pipeSpeed = 2.8, pipeGap = 200;
    let bird = { x: 50, y: 0, velocity: 0, radius: 12 }, pipes = [];

    const SCARE_IMAGES = ["assets/scare1.jpg", "assets/scare2.jpg"];
    const SCARE_SOUNDS = ["assets/scream.mp3"];

    // Preloader
    let assetsLoaded = 0;
    function checkAssets() {
        assetsLoaded++;
        if (assetsLoaded >= SCARE_IMAGES.length + SCARE_SOUNDS.length) {
            document.getElementById('loading-screen').style.display = 'none';
            gameActive = true;
        }
    }
    SCARE_IMAGES.forEach(src => { const img = new Image(); img.src = src; img.onload = checkAssets; img.onerror = checkAssets; });
    SCARE_SOUNDS.forEach(src => { const audio = new Audio(); audio.src = src; audio.oncanplaythrough = checkAssets; audio.onerror = checkAssets; });

    function resize() {
        dpr = window.devicePixelRatio || 1;
        width = window.innerWidth; height = window.innerHeight;
        canvas.style.width = width + 'px'; canvas.style.height = height + 'px';
        canvas.width = width * dpr; canvas.height = height * dpr;
        ctx.scale(dpr, dpr);
        bird.y = height / 2; bird.x = width * 0.25;
    }

    function triggerScare() {
        const js = document.getElementById('jumpscare');
        const img = document.getElementById('scare-img');
        const snd = document.getElementById('scream-snd');
        img.src = SCARE_IMAGES[Math.floor(Math.random() * SCARE_IMAGES.length)];
        snd.src = SCARE_SOUNDS[Math.floor(Math.random() * SCARE_SOUNDS.length)];
        snd.currentTime = 0;
        js.style.display = 'flex'; js.classList.add('shake-active');
        snd.play().catch(() => {});
        setTimeout(() => {
            js.style.display = 'none'; js.classList.remove('shake-active');
            snd.pause(); showEndScreen();
        }, 1100);
    }

    function gameOver() {
        if (!gameActive) return;
        gameActive = false;
        if (jumpscareEnabled && Math.random() < 0.3) {
            hasExperiencedScare = true; triggerScare();
        } else {
            showEndScreen();
        }
    }

    function showEndScreen() {
        const area = document.getElementById('content-area');
        const results = `<div style="margin-bottom:20px;"><div style="font-size:0.7rem; color:var(--neon-blue);">POINTS</div><div style="font-size:3rem; font-weight:bold;">${score}</div><div style="font-size:0.7rem; opacity:0.6;">BEST: ${highScore}</div></div>`;
        
        area.innerHTML = isLightMode ? 
            `<p>PEACE BE WITH YOU</p>${results}<div class="location-box"><span class="location-text">VISIT JRN 104</span><span class="date-text">FEB 11-14</span></div>` :
            `<p>YOUR SOUL IS MINE</p>${results}<div class="location-box"><span class="location-text">VISIT JRN 104</span><span class="date-text">FEB 11-14</span></div>`;
        
        if (hasExperiencedScare && !isLightMode) document.getElementById('jumpscare-toggle').style.display = 'block';
        overlay.style.display = 'flex';
    }

    function resetGame() {
        score = 0; pipes = []; bird.y = height / 2; bird.velocity = 0;
        scoreEl.innerText = "0"; gameActive = true; overlay.style.display = 'none';
    }

    function update() {
        if (!gameActive) return;
        bird.velocity += gravity; bird.y += bird.velocity;
        if (bird.y + bird.radius > height || bird.y - bird.radius < 0) gameOver();
        
        if (frameCount % 95 === 0) {
            pipes.push({ x: width, topHeight: Math.random() * (height - 300) + 50, passed: false });
        }
        
        pipes.forEach(p => {
            p.x -= pipeSpeed;
            if (bird.x + bird.radius > p.x && bird.x - bird.radius < p.x + 60) {
                if (bird.y - bird.radius < p.topHeight || bird.y + bird.radius > p.topHeight + pipeGap) gameOver();
            }
            if (!p.passed && p.x + 60 < bird.x) { 
                p.passed = true; score++; scoreEl.innerText = score;
                if (score > highScore) { 
                    highScore = score; localStorage.setItem('jrn104_highScore', highScore);
                }
            }
        });
        pipes = pipes.filter(p => p.x + 60 > 0);
        frameCount++;
    }

    function draw() {
        ctx.fillStyle = isLightMode ? '#f0f8ff' : '#050505';
        ctx.fillRect(0, 0, width, height);
        
        pipes.forEach(p => {
            ctx.fillStyle = isLightMode ? '#fff' : '#111';
            ctx.strokeStyle = isLightMode ? '#daa520' : '#ff4757';
            ctx.fillRect(p.x, 0, 60, p.topHeight);
            ctx.strokeRect(p.x, -2, 60, p.topHeight + 2);
            ctx.fillRect(p.x, p.topHeight + pipeGap, 60, height);
            ctx.strokeRect(p.x, p.topHeight + pipeGap, 60, height);
        });

        // DRAW BIRD
        const isBreakingRecord = score >= highScore && score > 0;
        ctx.fillStyle = isLightMode ? '#ffd700' : (isBreakingRecord ? '#ffd700' : '#00f2ff');
        
        if (isBreakingRecord) {
            ctx.shadowBlur = 20; ctx.shadowColor = '#ffd700'; // Golden Glow
        } else {
            ctx.shadowBlur = 15; ctx.shadowColor = ctx.fillStyle;
        }

        if (isLightMode) {
            ctx.fillRect(bird.x - 5, bird.y - 15, 10, 30); ctx.fillRect(bird.x - 15, bird.y - 5, 30, 10);
        } else {
            ctx.beginPath(); ctx.arc(bird.x, bird.y, 12, 0, Math.PI * 2); ctx.fill();
        }
        ctx.shadowBlur = 0;
    }

    function loop() { update(); draw(); requestAnimationFrame(loop); }

    const jump = (e) => { 
        if (e.target.tagName === 'BUTTON') return;
        if (e.type === 'touchstart') e.preventDefault(); 
        if (gameActive) bird.velocity = jumpPower; 
    };

    window.addEventListener('keydown', (e) => { if(e.code === 'Space' || e.code === 'ArrowUp') jump(e); });
    window.addEventListener('touchstart', jump, {passive: false});
    window.addEventListener('mousedown', jump);
    window.addEventListener('resize', resize);
    
    resize(); loop();
    
    function shareGame() { alert("Link Copied!"); navigator.clipboard.writeText(window.location.href); }
    function showSalvation() { document.getElementById('salvation-overlay').style.display = 'flex'; }
    function salvationAnswer(yes) { isLightMode = true; jumpscareEnabled = false; document.body.classList.add('light-mode'); document.getElementById('salvation-overlay').style.display = 'none'; resetGame(); }
</script>
</body>
</html>
